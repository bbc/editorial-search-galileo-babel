#!/usr/bin/env groovy
@org.jenkinsci.plugins.workflow.libs.Library('isite-jenkins-libs')
import bbc.isite.jenkinslibs.git.GithubNotifier

pipeline {
    agent { label '!forge' }
    options {
        timeout(time: 1, unit: 'HOURS')
        timestamps()
    }
    stages {
        stage('Build') {
            steps {
                checkout scm
                script {
                    new GithubNotifier().notifyGithubPending();
                }
            }
        }
        stage('Release') {
            steps {
                sh 'deploy.sh galileo-babel-lambda'
            }
        }
        stage('Deploy') {
            steps {
                sh 'cd infrasctructure/src; python -m babel.devenvironment --lambda-function-bucket galileo-babel-lambda --environment int --aws-accountId 195048873603 --region eu-west-2'
            }
        }
    }
  	post {
  		success {
  			script { new GithubNotifier().notifyGithubSuccess(); }
  		}
  		failure {
  			script { new GithubNotifier().notifyGithubFailure(); }
  		}
  	}
}
